#+title: ä»¥å¤ªåŠç ”ç©¶å¤‡å¿˜

**** gethå‘½ä»¤

| å‘½ä»¤                                                | æè¿°                                       |
|-----------------------------------------------------+--------------------------------------------|
| geth account new                                    | åˆ›å»ºä¸€ä¸ªå¸å·                               |
| geth account list                                   | æŸ¥è¯¢å·²ç»åˆ›å»ºçš„å¸æˆ·                         |
| keystore                                            | é‡Œé¢æ˜¯å¸æˆ·ä¿¡æ¯                             |
| web3.fromWei(eth.getBalance(eth.coinbase), "ether") | æŸ¥è¯¢å¸æˆ·ä¿¡æ¯ï¼Œåªæœ‰æœ‰é’±çš„ç”¨æˆ·æ‰èƒ½æŸ¥åˆ°       |
| geth wallet import ethereum-wallet-8936xxxxxx.json  | å¯¼å…¥é¢„å”®é’±åŒ…åœ°å€                           |
| geth console                                        | å®¢æˆ·ç«¯ç»ˆç«¯                                 |
| geth --networkid â€œaâ€                              | aä¸ºç½‘ç»œid ï¼ˆè¾“å…¥>2çš„ä»»æ„æ•°å­—å³å¯å¯åŠ¨ç§é“¾ï¼‰ |
| geth --testnet                                      | è¿æ¥åˆ°ä»¥å¤ªåŠæµ‹è¯•é“¾                         |
| geth --rpc                                          | å¯åŠ¨HTTP-RPCæœåŠ¡                           |
| geth --rpccorsdomain                                | è®¾ç½®è¯·æ±‚ipç™½åå• * ä¸ºæ‰€æœ‰                  |
| geth --networkid "888" --rpccorsdomain="*" --rpc    | å¸¸ç”¨ç»„åˆå‘½ä»¤                               |
|                                                     |                                            |

**** JavaScriptæ§åˆ¶å°å¸¸ç”¨å‘½ä»¤

| å‘½ä»¤                                                                                         | æè¿°                                           |
|----------------------------------------------------------------------------------------------+------------------------------------------------|
| admin.nodeInfo                                                                               | æŸ¥è¯¢å½“å‰èŠ‚ç‚¹ä¿¡æ¯                               |
| admin.peers                                                                                  | æŸ¥è¯¢å·²è¿æ¥çš„èŠ‚ç‚¹ä¿¡æ¯                           |
| etc.accounts                                                                                 | æŸ¥è¯¢è´¦æˆ·åˆ—è¡¨ä¿¡æ¯                               |
| personal.newAccount(â€œ123456")                                                               | åˆ›å»ºæ–°çš„è´¦æˆ· 123456 ä¸ºå¯†ç                      |
| personal.unlockAccount(â€˜0xaaaâ€¦â€™, '123456', 1000)                                          | è§£é”è´¦æˆ·0xaaaâ€¦ å¯†ç ä¸º 123456  è§£é”æ—¶é—´  1000s |
| eth.getBalance(â€˜0xaaaâ€¦â€™)                                                                  | æŸ¥è¯¢è´¦æˆ·ä»¥å¤ªå¸ä¿¡æ¯                             |
| eth.sendTransaction({from: â€˜0xaaaâ€¦â€™, to: â€˜0xbbb..â€™, value: web3.toWei(100,  â€œether")}) | å‘é€ä»¥å¤ªå¸  ä»0xaaa...ç»™ 0xbbbâ€¦               |
|                                                                                              |                                                |


**** å¸¸ç”¨jsæ–¹æ³•

æŸ¥è¯¢æ‰€æœ‰è´¦æˆ·ä»¥å¤ªå¸ä¿¡æ¯
#+BEGIN_SRC js

function checkAllBalances() { var i =0;

web3.eth.accounts.forEach( function(e){

console.log("eth.accounts["+i+"]: " +Â  e + "\tbalance:

"+web3.fromWei(web3.eth.getBalance(e), "ether") + " ether"); i++; })};

#+END_SRC

1. eth.sendTransaction()
#+BEGIN_SRC js

å‡å¦‚ä½ æƒ³ä»è‡ªå·±çš„åœ°å€0x036a03fc47084741f83938296a1c8ef67f6e34faå‘ç”Ÿ1ä¸ªä»¥å¤ªå¸åˆ°æ”¶æ¬¾æ–¹åœ°å€ 0x893608751d68d046e85802926673cdf2f57f7cb8ï¼Œè¾“å…¥eth.sendTransaction({from: '0x036a03fc47084741f83938296a1c8ef67f6e34fa', to: '0x893608751d68d046e85802926673cdf2f57f7cb8', value: web3.toWei(1, "ether")})ï¼Œå›è½¦ã€‚è¾“å…¥ä»¥ä¸Šå‘½ä»¤åï¼Œä¼šå‡ºç°å¦‚ä¸‹ç•Œé¢ï¼Œä¸æ˜¯é”™è¯¯ï¼Œå›è½¦å³å¯ã€‚æ³¨æ„ï¼Œä¸€å®šè¦åœ¨åœ°å€å‰é¢åŠ ä¸Š0xå‰ç¼€ã€‚

#+END_SRC



æŒ–çŸ¿èƒ½è§£å†³ä¸€åˆ‡äº‹æƒ…ã€‚

**** æ­å»ºç¯å¢ƒ

è¿™é‡Œå…ˆæ­å»ºç¯å¢ƒï¼Œ2ä¸ªèŠ‚ç‚¹äº’ç›¸è¿æ¥ç„¶åé€šä¿¡ã€‚åœ¨AèŠ‚ç‚¹ä¸Šç”Ÿæˆä¸€ä¸ªæ™ºèƒ½åˆçº¦å‘å¸ƒåˆ°ç§æœ‰é“¾ä¸Šï¼Œç„¶åå†åˆ°BèŠ‚ç‚¹ä¸Šåˆ©ç”¨AèŠ‚ç‚¹çš„åˆçº¦è¿›è¡Œè®¾ç½®ä¸€äº›åŠŸèƒ½ã€‚è°ƒç”¨AèŠ‚ç‚¹çš„æ–¹æ³•ã€‚

å‚è€ƒä¾‹å­ï¼š
- [[https://github.com/ethereum/go-ethereum/wiki/JavaScript-Console][jsçš„ä»£ç ]]
- [[http://ethfans.org/topics/176][ethereum-bootstrap]]
- [[http://8btc.com/thread-29538-1-1.html][gethæœ‰å…³jsonæ–‡ä»¶ç”¨æ³•]]
- [[http://ethfans.org/topics/175][solidilyç®€å•è¯­æ³•]]
- [[https://github.com/OneEther/OneThousand/blob/master/onethousand.sol][æŠ•ç¥¨]]
- [[https://github.com/ethereum/go-ethereum/wiki/Setting-up-private-network-or-local-cluster][è®¾ç½®ç§é“¾]]
- [[https://github.com/ethereum/go-ethereum/wiki/Contracts-and-Transactions#contract-info-metadata][transaction]]

****** åœ¨AèŠ‚ç‚¹ä¸Šå¯åŠ¨ç§é“¾


#+BEGIN_SRC bash
# åˆ›å»ºæ•°æ®ç›®å½•ï¼Œå¦‚æœä¹‹å‰æœ‰çš„è¯è¯·å…ˆåˆ é™¤å†é‡æ–°åˆ›å»º
mkdir -p /tmp/eth/60/01

geth --datadir="/tmp/eth/60/01" --genesis ./genesis.json --networkid "31415929" --ipcdisable --port 30301 --rpcport 8101 console

#+END_SRC

 
*genesis.json* æ–‡ä»¶å¿…é¡»è¦æœ‰ï¼Œå¦‚æœæ²¡æœ‰çš„è¯ï¼Œåé¢æŒ–çŸ¿ä¼šå¤±è´¥ï¼Œå› ä¸ºè¿™é‡Œæœ‰åˆ›ä¸–å—çš„ä¿¡æ¯ï¼Œå½“ç„¶è¿™å‡ ä¸ªåœ°å€æˆ‘å¹¶ä¸æƒ³ç”¨ã€‚æˆ‘åœ¨é‡Œé¢è‡ªå·±åˆ›å»ºåœ°å€æ¥ç”¨çš„ã€‚ä¸ç”¨å®ƒå›ºå®šçš„åœ°å€ä¹Ÿå¯ä»¥ã€‚

#+BEGIN_SRC text

{
  "alloc": {
    "3ae88fe370c39384fc16da2c9e768cf5d2495b48": {
      "balance": "1000000000000000000000000000000"
    },
    "81063419f13cab5ac090cd8329d8fff9feead4a0": {
      "balance": "2000000000000000000000000000000"
    },
    "9da26fc2e1d6ad9fdd46138906b0104ae68a65d8": {
      "balance": "3000000000000000000000000000000"
    },
    "bd2d69e3e68e1ab3944a865b3e566ca5c48740da": {
      "balance": "4000000000000000000000000000000"
    },
    "ca9f427df31a1f5862968fad1fe98c0a9ee068c4": {
      "balance": "5000000000000000000000000000000"
    }
  },

  "nonce": "0x0000000000000042",
  "difficulty": "0x020000",
  "mixhash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "coinbase": "0x0000000000000000000000000000000000000000",
  "timestamp": "0x00",
  "parentHash": "0x0000000000000000000000000000000000000000000000000000000000000000",
  "extraData": "0x11bbe8db4e347b4e8c937c1c8370e4b5ed33adb3db69cbdb7a38e1e50b1b82fa",
  "gasLimit": "0x4c4b40"
}

#+END_SRC

è¿è¡Œèµ·æ¥åï¼Œè‡ªå·±åˆ›å»ºä¸€ä¸ªå¸å·æ¥ç”¨ï¼Œå¯ä»¥åšå¦‚ä¸‹æ“ä½œï¼š
#+BEGIN_SRC bash
> admin.nodeInfo
{
  enode: "enode://fc74e3a60b5da1046828fa5a68c618c31f94ad29b3165c694ee0a8e3cab99390548ce463cfecbba62e0c9f71f3a906bce9f7f29ef90d9915f1273a30eacac515@0.0.0.0:30301",
  id: "fc74e3a60b5da1046828fa5a68c618c31f94ad29b3165c694ee0a8e3cab99390548ce463cfecbba62e0c9f71f3a906bce9f7f29ef90d9915f1273a30eacac515",
  ip: "0.0.0.0",
  listenAddr: "[::]:30301",
  name: "Geth/v1.3.6-9e323d65/linux/go1.5.1",
  ports: {
    discovery: 30301,
    listener: 30301
  },
  protocols: {
    eth: {
      difficulty: 131072,
      genesis: "19425866b7d3298a15ad79accf302ba9d21859174e7ae99ce552e05f13f0efa3",
      head: "19425866b7d3298a15ad79accf302ba9d21859174e7ae99ce552e05f13f0efa3",
      network: 31415929
    }
  }
}
> personal.newAccount("129129")
"0x6b1a547c422f823ee2f9e9dc2171e254948f7846"
> personal.listAccounts
["0x6b1a547c422f823ee2f9e9dc2171e254948f7846"]


> admin.peers
[]
> net.peerCount
0

#+END_SRC


ä»¥ä¸Šåœ¨AèŠ‚ç‚¹ä¸Šåˆ›å»ºç§é“¾å°±å®Œæˆäº†ã€‚

****** åœ¨AèŠ‚ç‚¹ä¸Šå†™æ™ºèƒ½åˆçº¦

è¿™é‡Œæˆ‘ä»¬å†™äº†ä¸€ä¸ªget,setæ–¹æ³•çš„ç¤ºä¾‹,ä»£ç å¦‚ä¸‹ï¼š

#+BEGIN_SRC cpp
contract Token {
    address issuer;
    uint public tk;
    mapping (address => uint) balances;
    event Issue(address account, uint amount);
    event Transfer(address from, address to, uint amount);
    function Token() {
        issuer = msg.sender;
    }      
    function issue(address account, uint amount) {
        if (msg.sender != issuer) throw;
        balances[account] += amount;
    }      
    function transfer(address to, uint amount) {
        if (balances[msg.sender] < amount) throw;
        balances[msg.sender] -= amount;
        balances[to] += amount;
        Transfer(msg.sender, to, amount);
    }      
    function getBalance(address account) constant returns (uint) {
        return balances[account];
    } 
    function set_tk(uint a) public {
        tk += a;
    }
    function get_tk() public constant returns (uint) {
        return tk;
    }
}

#+END_SRC

ç¬¬ä¸€æ­¥ï¼Œæˆ‘ä»¬å…ˆæŠŠåˆçº¦ä»£ç å‹ç¼©ä¸ºä¸€è¡Œï¼ï¼š`cat contracts/Token.sol | tr '\n' ' '`

åˆ‡æ¢åˆ°ä»¥å¤ªåŠæ§åˆ¶å°ï¼ŒæŠŠåˆçº¦ä»£ç ä¿å­˜ä¸ºä¸€ä¸ªå˜é‡:


#+BEGIN_SRC cpp
var tokenSource = 'contract Token {     address issuer;     mapping (address => uint) balances;      event Issue(address account, uint amount);     event Transfer(address from, address to, uint amount);      function Token() {         issuer = msg.sender;     }      function issue(address account, uint amount) {         if (msg.sender != issuer) throw;         balances[account] += amount;     }      function transfer(address to, uint amount) {         if (balances[msg.sender] < amount) throw;          balances[msg.sender] -= amount;         balances[to] += amount;          Transfer(msg.sender, to, amount);     }      function getBalance(address account) constant returns (uint) {         return balances[account];     } }';
#+END_SRC

ç„¶åç¼–è¯‘åˆçº¦ä»£ç ï¼š

#+BEGIN_SRC cpp
var tokenCompiled = web3.eth.compile.solidity(tokenSource);
#+END_SRC

é€šè¿‡ *kenCompiled.Token.code* å¯ä»¥çœ‹åˆ°ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶ä»£ç ï¼Œ

é€šè¿‡ *tokenCompiled.Token.info.abiDefinition* å¯ä»¥çœ‹åˆ°åˆçº¦çš„[[https://github.com/ethereum/wiki/wiki/Ethereum-Contract-ABI][ABI]]

æ¥ä¸‹æ¥æˆ‘ä»¬è¦æŠŠç¼–è¯‘å¥½çš„åˆçº¦éƒ¨ç½²åˆ°ç½‘ç»œä¸Šå»ï¼

é¦–å…ˆæˆ‘ä»¬ç”¨ABIæ¥åˆ›å»ºä¸€ä¸ªjavascriptç¯å¢ƒä¸­çš„åˆçº¦å¯¹è±¡ï¼š

#+BEGIN_SRC cpp
var contract = web3.eth.contract(tokenCompiled.Token.info.abiDefinition);
#+END_SRC


æˆ‘ä»¬é€šè¿‡åˆçº¦å¯¹è±¡æ¥éƒ¨ç½²åˆçº¦ï¼š

#+BEGIN_SRC cpp
var initializer = {from: web3.eth.accounts[0], data: tokenCompiled.Token.code, gas: 300000};

var callback = function(e, contract){
    if(!e) {
      if(!contract.address) {
        console.log("Contract transaction send: TransactionHash: " + contract.transactionHash + " waiting to be mined...");
      } else {
        console.log("Contract mined!");
        console.log(contract);
      }
    }
};

var token = contract.new(initializer, callback);

#+END_SRC

- *contract.new* æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°è®¾ç½®äº†è¿™ä¸ªæ–°åˆçº¦çš„åˆ›å»ºè€…åœ°å€ *from* , è¿™ä¸ªæ–°åˆçº¦çš„ä»£ç  *data*, å’Œç”¨äºåˆ›å»ºæ–°åˆçº¦çš„è´¹ç”¨ *gas* ï¼
- *gas* æ˜¯ä¸€ä¸ªä¼°è®¡å€¼ï¼Œåªè¦æ¯”æ‰€éœ€è¦çš„gaså¤šå°±å¯ä»¥ï¼Œåˆçº¦åˆ›å»ºå®Œæˆåå‰©ä¸‹çš„gasä¼šé€€è¿˜ç»™åˆçº¦åˆ›å»ºè€…ï¼
- *contract.new* æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®äº†ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå¯ä»¥å‘Šè¯‰æˆ‘ä»¬éƒ¨ç½²æ˜¯å¦æˆåŠŸï¼
- *contract.new* æ‰§è¡Œæ—¶ä¼šæç¤ºè¾“å…¥é’±åŒ…å¯†ç ï¼æ‰§è¡ŒæˆåŠŸåï¼Œæˆ‘ä»¬çš„åˆçº¦Tokenå°±å·²ç»å¹¿æ’­åˆ°ç½‘ç»œä¸Šäº†ï¼æ­¤æ—¶åªè¦ç­‰å¾…çŸ¿å·¥æŠŠæˆ‘ä»¬çš„åˆçº¦æ‰“åŒ…ä¿å­˜åˆ°ä»¥å¤ªåŠåŒºå—é“¾ä¸Šï¼Œéƒ¨ç½²å°±å®Œæˆäº†ï¼

åœ¨å…¬æœ‰é“¾ä¸Šï¼ŒçŸ¿å·¥æ‰“åŒ…å¹³å‡éœ€è¦15ç§’ï¼Œåœ¨ç§æœ‰é“¾ä¸Šï¼Œæˆ‘ä»¬éœ€è¦è‡ªå·±æ¥åšè¿™ä»¶äº‹æƒ…ï¼é¦–å…ˆå¼€å¯ *æŒ–çŸ¿* ï¼š

#+BEGIN_SRC cpp
miner.start(1)
#+END_SRC


æ­¤æ—¶éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä»¥å¤ªåŠèŠ‚ç‚¹ä¼šç”ŸæˆæŒ–çŸ¿å¿…é¡»çš„æ•°æ®ï¼Œè¿™äº›æ•°æ®éƒ½ä¼šæ”¾åˆ°å†…å­˜é‡Œé¢ï¼åœ¨æ•°æ®ç”Ÿæˆå¥½ä¹‹åï¼ŒæŒ–çŸ¿å°±ä¼šå¼€å§‹ï¼Œç¨åå°±èƒ½åœ¨æ§åˆ¶å°è¾“å‡ºä¸­çœ‹åˆ°ç±»ä¼¼ï¼š

#+BEGIN_SRC cpp
Constract Mined
#+END_SRC

çš„ä¿¡æ¯ï¼Œè¿™è¯´æ˜æŒ–åˆ°äº†ä¸€ä¸ªå—ï¼Œåˆçº¦å·²ç»éƒ¨ç½²åˆ°ä»¥å¤ªåŠç½‘ç»œä¸Šäº†ï¼æ­¤æ—¶æˆ‘ä»¬å¯ä»¥æŠŠæŒ–çŸ¿å…³é—­ï¼š


#+BEGIN_SRC cpp
miner.stop(1)
#+END_SRC

æ¥ä¸‹æ¥æˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨åˆçº¦äº†ï¼å…ˆé€šè¿‡ *token.address* è·å¾—åˆçº¦éƒ¨ç½²åˆ°çš„åœ°å€, ä»¥åæ–°å»ºåˆçº¦å¯¹è±¡æ—¶å¯ä»¥ä½¿ç”¨ï¼è¿™é‡Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨åŸæ¥çš„contractå¯¹è±¡ï¼š


#+BEGIN_SRC cpp
// æœ¬åœ°é’±åŒ…çš„ç¬¬ä¸€ä¸ªåœ°å€æ‰€æŒæœ‰çš„tokenæ•°é‡
> token.getBalance(web3.eth.accounts[0])
0

// å‘è¡Œ100ä¸ªtokenç»™æœ¬åœ°é’±åŒ…çš„ç¬¬ä¸€ä¸ªåœ°å€
> token.issue.sendTransaction(web3.eth.accounts[0], 100, {from: web3.eth.accounts[0]});
I1221 11:48:30.512296   11155 xeth.go:1055] Tx(0xc0712460a826bfea67d58a30f584e4bebdbb6138e7e6bc1dbd6880d2fce3a8ef) to: 0x37dc85ae239ec39556ae7cc35a129698152afe3c
"0xc0712460a826bfea67d58a30f584e4bebdbb6138e7e6bc1dbd6880d2fce3a8ef"

// å‘è¡Œtokenæ˜¯ä¸€ä¸ªtransaction, å› æ­¤éœ€è¦æŒ–çŸ¿ä½¿ä¹‹ç”Ÿæ•ˆ
> miner.start(1)
:hammer:Mined block
> miner.stop(1)

// å†æ¬¡æŸ¥è¯¢æœ¬åœ°é’±åŒ…ç¬¬ä¸€ä¸ªåœ°å€çš„tokenæ•°é‡
> token.getBalance(web3.eth.accounts[0])
100

// ä»ç¬¬ä¸€ä¸ªåœ°å€è½¬30ä¸ªtokenç»™æœ¬åœ°é’±åŒ…çš„ç¬¬äºŒä¸ªåœ°å€
> token.transfer.sendTransaction(web3.eth.accounts[1], 30, {from: web3.eth.accounts[0]})
I1221 11:53:31.852541   11155 xeth.go:1055] Tx(0x1d209cef921dea5592d8604ac0da680348987b131235943e372f8df35fd43d1b) to: 0x37dc85ae239ec39556ae7cc35a129698152afe3c
"0x1d209cef921dea5592d8604ac0da680348987b131235943e372f8df35fd43d1b"
> miner.start(1)
> miner.stop(2)
> token.getBalance(web3.eth.accounts[0])
70
> token.getBalance(web3.eth.accounts[1])
30

#+END_SRC

****** å…¶ä»–

ç§æœ‰é“¾çš„æ‰€æœ‰æ•°æ®éƒ½ä¼šæ”¾åœ¨ä»“åº“æ ¹ç›®å½•ä¸‹çš„ */tmp/eth/60/01* ç›®å½•ä¸­ï¼Œåˆ é™¤è¿™ä¸ªç›®å½•å¯ä»¥æ¸…é™¤æ‰€æœ‰æ•°æ®ï¼Œé‡æ–°å¯åŠ¨æ–°ç¯å¢ƒã€‚


****** åœ¨èŠ‚ç‚¹Bä¸Šåˆ›å»ºç§é“¾å¹¶ä¸”è¿æ¥åˆ°AèŠ‚ç‚¹ä¸Š


#+BEGIN_SRC bash
rm -rf /tmp/eth/60/02
mkdir /tmp/eth/60/02
geth --datadir="/tmp/eth/60/02" --genesis ./genesis.json --networkid "31415929" --ipcdisable --port 30302 --rpcport 8102 console

# ç„¶ååˆ›å»ºå¸å·
admin.nodeInfo
personal.newAccount("129129")
personal.listAccounts
admin.nodeInfo

miner.start(1) #è®°å¾—è¦æŒ–çŸ¿ï¼Œå¦‚æœä¸æŒ–çš„è¯ï¼Œå»ºçš„è¿™ä¸ªå¸å·æ˜¯æ²¡æœ‰é’±çš„ã€‚

miner.stop(1)

# æ¥ä¸‹æ¥åœ¨BèŠ‚ç‚¹ä¸Šå¢åŠ AèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œè¿™é‡Œé¢ä¸€å®šè¦æ”¹ä¸ºAèŠ‚ç‚¹çš„åœ°å€ä¸ç«¯å£å·ã€‚è¿™ä¸ªenodeå¯ä»¥åœ¨Aä¸Šé€šè¿‡adminæŸ¥çœ‹
admin.addPeer("enode://fc74e3a60b5da1046828fa5a68c618c31f94ad29b3165c694ee0a8e3cab99390548ce463cfecbba62e0c9f71f3a906bce9f7f29ef90d9915f1273a30eacac515@10.1.1.50:30301"}

# æ¥ä¸‹æ¥å°±èƒ½çœ‹åˆ°ä¿¡æ¯äº†ã€‚
admin.peers
#+END_SRC


åˆ›å»ºABIï¼Œåœ¨Aä¸Šå¤åˆ¶è¿‡æ¥ã€‚

#+BEGIN_SRC cpp

var cc = web3.eth.contract([{
    constant: false,
    inputs: [{
        name: "x",
        type: "uint256"
    }],
    name: "settk",
    outputs: [],
    type: "function"
}, {
    constant: true,
    inputs: [],
    name: "gettk",
    outputs: [{
        name: "",
        type: "uint256"
    }],
    type: "function"
}, {
    constant: false,
    inputs: [{
        name: "account",
        type: "address"
    }, {
        name: "amount",
        type: "uint256"
    }],
    name: "issue",
    outputs: [],
    type: "function"
}, {
    constant: false,
    inputs: [{
        name: "to",
        type: "address"
    }, {
        name: "amount",
        type: "uint256"
    }],
    name: "transfer",
    outputs: [],
    type: "function"
}, {
    constant: true,
    inputs: [{
        name: "account",
        type: "address"
    }],
    name: "getBalance",
    outputs: [{
        name: "",
        type: "uint256"
    }],
    type: "function"
}, {
    inputs: [],
    type: "constructor"
}, {
    anonymous: false,
    inputs: [{
        indexed: false,
        name: "account",
        type: "address"
    }, {
        indexed: false,
        name: "amount",
        type: "uint256"
    }],
    name: "Issue",
    type: "event"
}, {
    anonymous: false,
    inputs: [{
        indexed: false,
        name: "from",
        type: "address"
    }, {
        indexed: false,
        name: "to",
        type: "address"
    }, {
        indexed: false,
        name: "amount",
        type: "uint256"
    }],
    name: "Transfer",
    type: "event"
}])


#+END_SRC

åˆ›å»ºå¥½abiå¯¹è±¡ä¹‹åï¼Œå°±å¯ä»¥ç”¨æ™ºèƒ½åˆçº¦é‡Œé¢çš„ä¸œè¥¿äº†ã€‚
#+BEGIN_SRC cpp
// çœ‹çœ‹æœ‰æ²¡æœ‰é’±
web3.eth.getBalance("0xb9fff215ea44ff1f0df7d745f21f32df8ca68be5")

// è°ƒç”¨setæ–¹æ³•
cc.at('0x7f8dcf9fbbd0241325d5b32b847dac61e276e508').set_tk.sendTransaction(900, {from: web3.eth.accounts[0]});

// è°ƒç”¨ getæ–¹æ³•
cc.at('0x7f8dcf9fbbd0241325d5b32b847dac61e276e508').get_tk()

#+END_SRC



****** ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•

#+BEGIN_SRC bash

# æŸ¥çœ‹æ‰€æœ‰å¸å·
> eth.accounts
['0x407d73d8a49eeb85d32cf465507dd71d507100c1']

# è¿™ä¸ªæ˜¯åˆ›ä¸–å—çš„åœ°å€ï¼Œå¦‚æœæ˜¯ç§é“¾å°±æ˜¯è‡ªå·±çš„ç¬¬ä¸€ä¸ªå¸æˆ·åœ°å€
> eth.coinbase

# To check your the etherbase account balance:
# æŸ¥çœ‹ä½ å¸å·ä¸Šçš„åœ°å€ï¼Œæ¢æˆä»¥å¤ªå¸æ‰“å°å‡ºæ¥
> web3.fromWei(eth.getBalance(eth.coinbase), "ether")
6.5

#+END_SRC

æ‰“å°é’±åŒ…é‡Œé¢çš„é’±
#+BEGIN_SRC javascript
// Print all balances with a JavaScript function:
// æ‰“å°æ‰€æœ‰çš„é’±åŒ…é‡Œé¢æœ‰å¤šå°‘é’±

function checkAllBalances() { 
var i =0; 
eth.accounts.forEach( function(e){
    console.log("  eth.accounts["+i+"]: " +  e + " \tbalance: " + web3.fromWei(eth.getBalance(e), "ether") + " ether"); 
i++; 
})
}; 

#+END_SRC

ç»“æœæŸ¥çœ‹
#+BEGIN_SRC bash
# That can then be executed with:

> checkAllBalances();
  eth.accounts[0]: 0xd1ade25ccd3d550a7eb532ac759cac7be09c2719   balance: 63.11848 ether
  eth.accounts[1]: 0xda65665fc30803cb1fb7e6d86691e20b1826dee0   balance: 0 ether
  eth.accounts[2]: 0xe470b1a7d2c9c5c6f03bbaa8fa20db6d404a0c32   balance: 1 ether
  eth.accounts[3]: 0xf4dd5c3794f1fd0cdc0327a83aa472609c806e99   balance: 6 ether
#+END_SRC


*loadScript()*
ä¸Šé¢çš„checkAllBalances()å‡½æ•°å¯ä»¥ä¿å­˜åœ¨ä¸€ä¸ªjsæ–‡ä»¶è¿™ä¸­ã€‚ç„¶ååˆ©ç”¨loadScript()æ¥è°ƒç”¨ã€‚

#+BEGIN_SRC javascript
> loadScript("/Users/liweilijie/gethload.js")
true
#+END_SRC 

*miner.start(4)* 4ä¸ªçº¿ç¨‹æ¥æŒ–çŸ¿

#+BEGIN_SRC bash
# With the number of THREADS as an arguments:
> miner.start(4)

> miner.stop(1)

#+END_SRC


****** personal


#+BEGIN_SRC javascript

// List all accounts
personal.listAccounts
// Return: collection with accounts


// Create a new password protected account
personal.newAccount(passwd)

// åˆ›å»ºå¸å·
personal.newAccount("mypasswd")

// åˆ é™¤å¸å·
personal.deleteAccount
personal.deleteAccount(addr, passwd)
// ä¾‹å­
personal.deleteAccount(eth.coinbase, "mypasswd")


// Unlock the account with the given address, password and an optional duration (in seconds)
personal.unlockAccount(addr, passwd, duration)
// return: boolean indication if the account was unlocked
// Example
personal.unlockAccount(eth.coinbase, "mypasswd", 300)


#+END_SRC


****** admin

#+BEGIN_SRC javascript

> admin.datadir
"/tmp/eth/60/01"

#+END_SRC

ä¸€ä¸ªåœ°å€ç»™å¦å¤–ä¸€ä¸ªåœ°å€è½¬é’±ï¼š

#+BEGIN_SRC javascript
eth.sendTransaction({from: '0xaaa..', to: '0xbbb..', value: web3.toWei(1, "ether")})
#+END_SRC


åˆ é™¤ä¸€ä¸ªStructé‡Œé¢æ‰€æœ‰çš„æˆå‘˜ï¼Œå›æ”¶å†…å­˜
#+BEGIN_SRC js

// delete for structs
// PT delete clears all members of a struct.

contract Contract {
  struct Data {
    uint deadline;
    uint amount;
  }
  Data data;
  function set(uint id, uint deadline, uint amount) {
    data.deadline = deadline;
    data.amount = amount;
  }
  function clear(uint id) { delete data; }
}

#+END_SRC


logç»ˆç«¯æ–¹æ³•ï¼š
#+BEGIN_SRC js

> console.log(source)
contract test { function multiply(uint a) returns(uint d) { return a * 7; } }
undefined
> var compiledTest = web3.eth.compile.solidity(source);

#+END_SRC


#+BEGIN_SRC bash

src solc --help
#solc, the Solidity commandline compiler.
#Usage: solc [options] [input_file...]
#Compiles the given Solidity input files (or the standard input if none given) and
#outputs the components specified in the options at standard output or in files in
#the output directory, if specified.
Example: solc --bin -o /tmp/solcoutput contract.sol

#+END_SRC

****** é€šè¿‡Eventæ‰“å°æ—¥å¿—çš„æ–¹æ³•

#+BEGIN_SRC js

contract ClientReceipt {
    event Deposit(
        address indexed _from,
        bytes32 indexed _id,
        uint _value
    );
    function deposit(bytes32 _id) {
        // Any call to this function (even deeply nested) can
        // be detected from the JavaScript API by filtering
        // for `Deposit` to be called.
        Deposit(msg.sender, _id, msg.value);
    }
}

#+END_SRC

The use in the JavaScript API would be as follows:
#+BEGIN_SRC js

var abi = /* abi as generated by the compiler */;
var ClientReceipt = web3.eth.contract(abi);
var clientReceipt = ClientReceipt.at(0x123 /* address */);

var event = clientReceipt.Deposit();

// watch for changes
event.watch(function(error, result){
    // result will contain various information
    // including the argumets given to the Deposit
    // call.
    if (!error)
        console.log(result);
});

// Or pass a callback to start watching immediately
var event = clientReceipt.Deposit(function(error, result) {
    if (!error)
        console.log(result);
});





#+END_SRC


#+BEGIN_SRC bash

var mm = cc.at('0x36be895ff8629e00bcb088506db64327827cce5d');
var event = mm.Deposit();
event

event.watch(function(error, result){
    if (!error){
        console.log(result);
        console.log(result.args._value);
    }
});

mm.deposit.sendTransaction(1, {from: web3.eth.accounts[1], value: 1500});
miner.start(1)

# æŒ–çŸ¿å°±å¯ä»¥watchingäº‹ä»¶æ‰“å°çš„ä¿¡æ¯äº†
I0419 18:08:13.084391    4747 worker.go:447] ğŸ”¨ ğŸ”—  Mined 5 blocks back: block #458
I0419 18:08:13.084652    4747 worker.go:569] commit new work on block 464 with 0 txs & 0 uncles. Took 229.035Âµs
[object Object]
1500
I0419 18:08:19.799130    4747 worker.go:348] ğŸ”¨  Mined block (#464 / 7822fbd3). Wait 5 blocks for confirmation
I0419 18:08:19.799500    4747 worker.go:569] commit new work on block 465 with 0 txs & 0 uncles. Took 341.615Âµs
I0419 18:08:19.799525    4747 worker.go:447] ğŸ”¨ ğŸ”—  Mined 5 blocks back: block #459

# åœæ­¢Watchæ–¹æ³•
event.stopWatching()
#+END_SRC
